<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit Recipe – RecipeNest</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
    .form-card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .brand { font-size: 1.5rem; font-weight: bold; color: #28a745; }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div class="d-flex align-items-center gap-3">
        <img src="https://cdn-icons-png.flaticon.com/512/1046/1046784.png" alt="logo" width="40" height="40">
        <span class="brand">RecipeNest</span>
      </div>
      <a href="/index.html" class="btn btn-outline-secondary">← Back</a>
    </div>

    <div class="form-card mx-auto" style="max-width: 600px;">
      <h3 class="mb-4 text-center text-primary">Edit Recipe</h3>
      <form id="editForm">
        <div class="mb-3">
          <label class="form-label">Title</label>
          <input type="text" class="form-control" name="title" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Cook Time (minutes)</label>
          <input type="number" class="form-control" name="cook_time" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Ingredients (comma separated)</label>
          <input type="text" class="form-control" name="ingredients" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Steps (comma separated)</label>
          <input type="text" class="form-control" name="steps" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Tags (comma separated)</label>
          <input type="text" class="form-control" name="tags">
        </div>
        <div class="mb-3">
          <label class="form-label">Image URL</label>
          <input type="url" class="form-control" name="image_url">
        </div>
        <button type="submit" class="btn btn-success w-100 mb-2">Save Changes</button>
        <button id="deleteBtn" type="button" class="btn btn-danger w-100">Delete Recipe</button>
      </form>
    </div>
  </div>

  <script src="config.js"></script>
  <script>
    const params = new URLSearchParams(window.location.search);
    const recipeId = params.get('id');

    // Populate form with existing data
    fetch(`${API_BASE_URL}/api/recipes/${recipeId}/`)
      .then(res => res.json())
      .then(data => {
        const form = document.getElementById('editForm');
        form.title.value = data.title;
        form.cook_time.value = data.cook_time;
        form.ingredients.value = data.ingredients.join(', ');
        form.steps.value = data.steps.join(', ');
        form.tags.value = data.tags.join(', ');
        form.image_url.value = data.image_url;
      });

    // Handle updates
    document.getElementById('editForm').addEventListener('submit', e => {
      e.preventDefault();
      const f = e.target;
      const payload = {
        title: f.title.value,
        cook_time: parseInt(f.cook_time.value),
        ingredients: f.ingredients.value.split(',').map(i => i.trim()),
        steps: f.steps.value.split(',').map(s => s.trim()),
        tags: f.tags.value ? f.tags.value.split(',').map(t => t.trim()) : [],
        image_url: f.image_url.value
      };
      fetch(`${API_BASE_URL}/api/recipes/${recipeId}/`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      }).then(res => {
        if (res.ok) window.location.href = '/index.html';
        else alert('Update failed');
      });
    });

    // Handle delete
    document.getElementById('deleteBtn').addEventListener('click', () => {
      if (confirm('Are you sure you want to delete this recipe?')) {
        fetch(`${API_BASE_URL}/api/recipes/${recipeId}/`, { method: 'DELETE' })
          .then(res => {
            if (res.ok) window.location.href = '/index.html';
            else alert('Delete failed');
          });
      }
    });
  </script>
</body>
</html>